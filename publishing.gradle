apply plugin: 'com.jfrog.artifactory'
apply plugin: 'maven-publish'

def packageName = 'com.instacart.library'
def artifactoryRepositoryVariant

version = versionName
group = 'com.github.instacart'

publishing {
    repositories {
        maven {
            credentials {
                username "${artifactory_user}"
                password "${artifactory_password}"
            }

            if (artifactory_variant == "release") {
                version = version + "-WND"
                artifactoryRepositoryVariant = "release"
            } else {
                version = version + "-SNAPSHOT"
                artifactoryRepositoryVariant = "snapshot"
            }

            url "${artifactory_contextUrl}/libs-${artifactoryRepositoryVariant}-local"
        }
    }
    publications {
        aar(MavenPublication) {
            groupId = packageName
            artifactId = archivesBaseName

            def targetFile = "$buildDir/outputs/aar/${artifactId}-${version}.aar"
            println "publishing: " + targetFile
            // Tell maven to prepare the generated "*.aar" file for publishing
            artifact(targetFile)
        }
    }
}
